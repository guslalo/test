<div class="row">
  <div class="col mb-2">
    <h2>Pacientes</h2>
  </div>
  <div class="col">
    <button
      type="button"
      class="btn btn-primary rounded-pill float-right d-none"
      ng-reflect-tour-anchor="agendar"
      data-toggle="modal"
      data-target="#disponibilidad"
    >
      nueva consulta
      <svg
        width="1.5em"
        height="1.5em"
        viewBox="0 0 16 16"
        class="bi bi-plus-circle"
        fill="currentColor"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          fill-rule="evenodd"
          d="M8 3.5a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5H4a.5.5 0 0 1 0-1h3.5V4a.5.5 0 0 1 .5-.5z"
        />
        <path fill-rule="evenodd" d="M7.5 8a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1H8.5V12a.5.5 0 0 1-1 0V8z" />
        <path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
      </svg>
    </button>
  </div>
</div>

<div class="row">
  <div class="col-12">
    <div class="row mt-2">
      <div class="col-3">
        <input
          [(ngModel)]="searchTerm"
          type="text"
          class="form-control"
          placeholder="Busqueda"
          (keyup)="applyFilters()"
        />
        <div class="searchBox">
          <img src="assets/icons/icon-search.svg" />
        </div>
      </div>
    </div>
    <!--consultas activas-->
    <div class="row mt-3">
      <div class="col-12">
        <div class="tableBox rounded p-4 bg-white">
          <ngx-datatable
            *ngIf="patients.length; else noData"
            #table
            class="material"
            [rows]="patients"
            headerHeight="auto"
            footerHeight="auto"
            rowHeight="70"
            [columnMode]="ColumnMode.flex"
            [limit]="10"
            [selectAllRowsOnPage]="true"
          >
            <ngx-datatable-column [resizeable]="false" [flexGrow]="1" name="ID Paciente">
              <ng-template let-row="row" ngx-datatable-cell-template>
                <span>{{
                  row.identificationData?.cpf ||
                    row.identificationData?.cns ||
                    row.identificationData?.rgRegistry ||
                    row.identificationData?.passport
                }}</span>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [resizeable]="false" [flexGrow]="3" name="Nombre Paciente">
              <ng-template let-row="row" ngx-datatable-cell-template>
                <a routerLink="{{ row.userId }}">
                  <img
                    *ngIf="(row.patientDetails?.userDetails)[0]?.photo; else noPhoto"
                    class="profile mr-2"
                    id="image0"
                    width="38"
                    height="38"
                    [src]="photoUrlBase + (row.patientDetails?.userDetails)[0]?.photo"
                    alt="img"
                  />
                  <ng-template #noPhoto>
                    <img class="profile mr-2" id="image0" width="38" height="38" src="/assets/profile.jpg" alt="img" />
                  </ng-template>
                  {{ row.personalData?.name + ' ' + (row.personalData?.secondLastName || row.personalData?.lastName) }}
                </a>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [resizeable]="false" [flexGrow]="1" name="Edad">
              <ng-template let-row="row" ngx-datatable-cell-template>
                {{ moment().diff(row.personalData.birthdate, 'year') }}
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [resizeable]="false" [flexGrow]="1" name="Sexo">
              <ng-template let-row="row" ngx-datatable-cell-template>
                {{
                  row.personalData.gender === 'male'
                    ? 'Masculino'
                    : row.personalData.gender === 'female'
                    ? 'Femenino'
                    : 'S/R'
                }}
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [resizeable]="false" [flexGrow]="2" prop="personalData.phoneNumber" name="Telefono">
            </ngx-datatable-column>
            <ngx-datatable-column [resizeable]="false" [flexGrow]="2" name="Accion">
              <ng-template let-row="row" ngx-datatable-cell-template>
                <button
                  type="button"
                  class="btn btn-outline-secondary rounded-pill btn-sm"
                  routerLink="{{ row.userId }}"
                >
                  Ver Ficha
                </button>
              </ng-template>
            </ngx-datatable-column>
          </ngx-datatable>
          <ng-template #noData>
            <h5 class="text-center text-primary">No se han encontrado pacientes asociados</h5>
          </ng-template>
        </div>
      </div>
    </div>
  </div>
</div>
