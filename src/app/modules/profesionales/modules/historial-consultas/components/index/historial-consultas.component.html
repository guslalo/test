<div class="row">
  <div class="col mb-2">
    <h2>{{ 'common.menu.history.label' | transloco }}</h2>
  </div>
  <div class="col">
    <button *ngxPermissionsOnly="['Set:Appointment']" #newAppointment id="newAppointment" type="button" class="btn btn-primary rounded-pill float-right"
      ng-reflect-tour-anchor="agendar" data-toggle="modal" data-target="#modalAppointment">
      {{ 'clinicalFile.newService.label' | transloco }}
      <img src="assets/icons/icon-plus-circle.svg" alt="img" />
    </button>

    <!-- <button type="button" class="btn btn-primary rounded-pill float-right d-none" ng-reflect-tour-anchor="agendar"
      data-toggle="modal" data-target="#disponibilidad">
      {{ 'clinicalFile.newService.label' | transloco }}
      <svg width="1.5em" height="1.5em" viewBox="0 0 16 16" class="bi bi-plus-circle" fill="currentColor"
        xmlns="http://www.w3.org/2000/svg">
        <path fill-rule="evenodd"
          d="M8 3.5a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5H4a.5.5 0 0 1 0-1h3.5V4a.5.5 0 0 1 .5-.5z" />
        <path fill-rule="evenodd" d="M7.5 8a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1H8.5V12a.5.5 0 0 1-1 0V8z" />
        <path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
      </svg>
    </button> -->
  </div>
</div>

<div class="row">
  <div class="col-12">
    <ul class="nav nav-tabs" id="myTab" role="tablist">
      <li class="nav-item" role="presentation">
        <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home"
          aria-selected="true">
          <svg width="1.5em" height="1.5em" viewBox="0 0 16 16" class="bi bi-list-nested" fill="currentColor"
            xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd"
              d="M4.5 11.5A.5.5 0 0 1 5 11h10a.5.5 0 0 1 0 1H5a.5.5 0 0 1-.5-.5zm-2-4A.5.5 0 0 1 3 7h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm-2-4A.5.5 0 0 1 1 3h10a.5.5 0 0 1 0 1H1a.5.5 0 0 1-.5-.5z" />
          </svg>
          {{ 'history.tabs.latest.label' | transloco }}
        </a>
      </li>
      <li class="nav-item" role="presentation">
        <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile"
          aria-selected="false">
          <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-calendar3-fill" fill="currentColor"
            xmlns="http://www.w3.org/2000/svg">
            <path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2H0z" />
            <path fill-rule="evenodd"
              d="M0 3h16v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3zm6.5 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm4-1a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm2 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm-8 2a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm2 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm4-1a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm2 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm-8 2a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm2 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm4-1a1 1 0 1 1-2 0 1 1 0 0 1 2 0z" />
          </svg>
          {{ 'clinicalFile.patientData.tabs.timeLine.label' | transloco }}
        </a>
      </li>
    </ul>

    <div class="tab-content pt-4">
      <!--tab-->
      <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
        <div class="row mt-2 d-none">
          <div class="col-12 col-md-3">
            <input id="typeahead-basic" type="text" class="form-control" [(ngModel)]="model" [ngbTypeahead]="search"
              placeholder="{{ 'common.placeholder.search.label' | transloco }}" />
            <div class="searchBox">
              <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-search" fill="currentColor"
                xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd"
                  d="M10.442 10.442a1 1 0 0 1 1.415 0l3.85 3.85a1 1 0 0 1-1.414 1.415l-3.85-3.85a1 1 0 0 1 0-1.415z" />
                <path fill-rule="evenodd"
                  d="M6.5 12a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zM13 6.5a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0z" />
              </svg>
            </div>
          </div>
          <div class="col-12 col-md-3">
            <div class="form-group">
              <select class="form-control" id="exampleFormControlSelect1">
                <option>{{ 'common.dropdown.filter.label' | transloco }}</option>
                <option>2</option>
                <option>3</option>
                <option>4</option>
                <option>5</option>
              </select>
            </div>
          </div>
          <div class="col-12 col-md-3">
            <input class="form-control" type="text" placeholder="DD/MM/YYYY" id="endDate" name="endDate"
              [(ngModel)]="model2" [minDate]="{ year: 1940, month: 1, day: 1 }" ngbDatepicker #e="ngbDatepicker"
              (click)="e.toggle()" />
          </div>
        </div>
        <!--consultas activas-->
        <div class="row mt-1">
          <div class="col-12">
            <h5 style="display: none;">{{ 'clinicalFile.acriveServices.label' | transloco }}</h5>
          </div>
          <div class="col-12 mb-4">
            <div class="tableBox rounded p-4 bg-white">
              <table class="table">
                <thead class="">
                  <tr>
                    <th scope="col">{{ 'clinicalFile.patientData.tabs.services.table.id.label' | transloco }}</th>
                    <th scope="col">{{ 'clinicalFile.patientData.tabs.services.table.name.label' | transloco }}</th>
                    <th scope="col">{{ 'clinicalFile.patientData.tabs.services.table.date.label' | transloco }}</th>
                    <th scope="col">{{ 'clinicalFile.patientData.tabs.services.table.hour.label' | transloco }}</th>
                    <th scope="col">{{ 'clinicalFile.patientData.tabs.services.table.room.label' | transloco }}</th>
                    <th scope="col">
                      {{ 'clinicalFile.patientData.tabs.identification.info.status.label' | transloco }}
                    </th>
                    <th scope="col">{{ 'clinicalFile.patientData.tabs.services.table.action.label' | transloco }}</th>
                  </tr>
                </thead>
                <tbody>

                  <ng-container *ngIf="consultas && consultas.length === 0; else data">
                    <div class="alert alert-warning mt-2" role="alert">
                      {{ 'common.noInfo.label' | transloco }}
                    </div>
                  </ng-container>

                  <ng-template #data>
                    <tr *ngFor="let item of consultas | slice: (page - 1) * 10:(page - 1) * 10 + 10"
                      id="{{ item._id }}">
                      <td scope="row" *ngIf="item.patientDetails.userDetails[0]; else sinInfo1">
                        {{ item.patientDetails.userDetails[0].userId }}
                      </td>
                      <ng-template #sinInfo1>
                        <td scope="row">{{ 'common.noInfo.label' | transloco }}</td>
                      </ng-template>
                      <td scope="row" *ngIf="item.patientDetails.userDetails[0]; else sinInfo">
                        {{ item.patientDetails.userDetails[0].personalData.name }}
                        {{ setup =='CL' ? item.patientDetails.userDetails[0].personalData.lastName : item.patientDetails.userDetails[0].personalData.secondLastName }}
                      </td>
                      <ng-template #sinInfo>
                        <td scope="row">{{ 'common.noInfo.label' | transloco }}</td>
                      </ng-template>
                      <td>
                        {{ item.dateDetails.date | date: 'dd/MM/yyyy':'+0000' }}
                      </td>
                      <td>{{ item.dateDetails.start }} hrs</td>
                      <td>
                        sala
                      </td>
                      <td>
                        <button type="button" class="btn btn-secondary rounded-pill btn-sm">
                          {{
                            (item.administrativeDetails.status === 'reserved'
                              ? 'clinicalFile.reserved.label'
                              : item.administrativeDetails.status === 'appointed'
                              ? 'clinicalFile.scheduled.label'
                              : item.administrativeDetails.status === 'rescheduled'
                              ? 'clinicalFile.reScheduled.label'
                              : item.administrativeDetails.status === 'active'
                              ? 'clinicalFile.active.label'
                              : item.administrativeDetails.status === 'waitingInRoom'
                              ? 'clinicalFile.inWaitingRoom.label'
                              : item.administrativeDetails.status === 'waitingInList'
                              ? 'clinicalFile.inWaitingList.label'
                              : item.administrativeDetails.status === 'running'
                              ? 'common.status.inProgress.label'
                              : item.administrativeDetails.status === 'pending'
                              ? 'clinicalFile.pending.label'
                              : item.administrativeDetails.status === 'finished'
                              ? 'clinicalFile.ended.label'
                              : item.administrativeDetails.status === 'canceled'
                              ? 'clinicalFile.canceled.label'
                              : 'S/R'
                            ) | transloco
                          }}
                        </button>
                      </td>
                      <td>
                        
                        <ng-container>
                          <div ngbDropdown container="body">
                            <button class="btn btn-light btn-sm rounded-pill" ngbDropdownToggle>
                              <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-three-dots"
                                fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                  d="M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z" />
                              </svg>
                            </button>

                            <div ngbDropdownMenu>
                              <ng-container *ngIf="item.administrativeDetails.status === 'finished'">
                                <a routerLink="/app-professional/ficha-consulta/{{ item._id }}">
                                  <button ngbDropdownItem type="button">
                                    {{ 'clinicalFile.viewMedCard.label' | transloco }}
                                  </button>
                                </a>
                              </ng-container>
                              
                              <!-- <ng-container *ngIf="
                                  item.administrativeDetails.status === 'running' ||
                                  item.administrativeDetails.status === 'active' ||
                                  item.administrativeDetails.status === 'pending'
                                ">
                                <a *ngIf="item.patientDetails.userDetails[0]"
                                routerLink="/app-professional/crear-ficha-consulta/{{ item._id }}">
                                  <button ngbDropdownItem type="button">
                                    {{ 'clinicalFile.attend.label' | transloco }}
                                  </button>
                                </a>
                              </ng-container> -->

                              <!-- <div *ngIf="item.canUse">
                                <button *ngxPermissionsOnly="['Update:Appointment']" ngbDropdownItem type="button" (click)=openModalReagendamiento(item)
                                  data-toggle="modal" data-target="#modalReAgendamiento">
                                    {{ 'clinicalFile.reschedule.label' | transloco }}
                                </button>
                              </div> -->

                              <!-- <div>
                                <button *ngxPermissionsOnly="['Delete:Appointment']" ngbDropdownItem type="button" (click)="setAppointmentCancelReasons(item)"
                                  data-toggle="modal" data-target="#modalCancelAppointment">
                                  {{ 'dashboard.home.uncategorized.cancelService.label' | transloco }}
                                </button>
                              </div> -->

                            </div>
                          </div>
                        </ng-container>

                      </td>
                    </tr>
                  </ng-template>
                </tbody>
              </table>
              <ngb-pagination [(page)]="page" [collectionSize]="totalPages"></ngb-pagination>
            </div>
          </div>
        </div>
      </div>
      <!--tab-->
      <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
        <div class="row">
          <div class="col-12 text-center bg-white">
            <div class="container bg-white p-5">
              <h5 class="mb-0 text-left">{{ 'clinicalFile.patientData.tabs.timeLine.label' | transloco }}</h5>
              <div class="timeLine">
                <div class="line bg-white">{{ fecha.year }}</div>
                <div class="line">
                  <button class="btn btn-secondary rounded-lg">
                    {{
                      (fecha.month === 'enero'
                        ? 'year.january.label'
                        : fecha.month === 'febrero'
                        ? 'year.february.label'
                        : fecha.month === 'marzo'
                        ? 'year.march.label'
                        : fecha.month === 'abril'
                        ? 'year.april.label'
                        : fecha.month === 'mayo'
                        ? 'year.may.label'
                        : fecha.month === 'junio'
                        ? 'year.june.label'
                        : fecha.month === 'julio'
                        ? 'year.july.label'
                        : fecha.month === 'agosto'
                        ? 'year.august.label'
                        : fecha.month === 'septiembre'
                        ? 'year.september.label'
                        : fecha.month === 'octubre'
                        ? 'year.october.label'
                        : fecha.month === 'noviembre'
                        ? 'year.november.label'
                        : fecha.month === 'diciembre'
                        ? 'year.december.label'
                        : null
                      ) | transloco
                    }}
                  </button>
                </div>
                <ng-container *ngFor="let item of timeline">
                  <div class="line">
                    <div class="row align-items-center">
                      <div class="col-5 text-right p-0">
                        <h3>{{ item.date | date: 'dd' }}</h3>
                        {{ item.startAt }} hrs.
                      </div>
                      <div class="col p-0">
                        <svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <circle cx="7.5" cy="7.5" r="7.5" fill="#3BC4CA" />
                        </svg>
                      </div>
                      <div class="col-5 text-left p-0">
                        <button class="btn btn-primary dos rounded-lg">
                          {{
                            (item.status === 'reserved'
                              ? 'clinicalFile.reserved.label'
                              : item.status === 'appointed'
                              ? 'clinicalFile.scheduled.label'
                              : item.status === 'rescheduled'
                              ? 'clinicalFile.reScheduled.label'
                              : item.status === 'active'
                              ? 'clinicalFile.active.label'
                              : item.status === 'waitingInRoom'
                              ? 'clinicalFile.inWaitingRoom.label'
                              : item.status === 'waitingInList'
                              ? 'clinicalFile.inWaitingList.label'
                              : item.status === 'running'
                              ? 'common.status.inProgress.label'
                              : item.status === 'pending'
                              ? 'clinicalFile.pending.label'
                              : item.status === 'finished'
                              ? 'clinicalFile.ended.label'
                              : item.status === 'canceled'
                              ? 'clinicalFile.canceled.label'
                              : null
                            ) | transloco
                          }}
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="line">
                    <div class="row align-items-center">
                      <div class="col-5 text-right p-0">
                        <div class="box">
                          <div class="boxCont text-center">
                            <div class="row">
                              <div class="col-3">
                                <div class="imgTimeline rounded-circle">
                                  <ng-container *ngIf="item.professional.photo != null; else sinFoto">
                                    <img [src]="item.professional.photo">
                                  </ng-container>
                                  <ng-template #sinFoto>
                                    <img src="assets/profile.jpg">
                                  </ng-template>
                                </div>
                              </div>
                              <div class="col-9">
                                <p class="m-0 text-left">{{ 'clinicalFile.apointmentWith.label' | transloco }}</p>
                                <p class="m-0 text-left">
                                  {{ 'clinicalFile.dr.label' | transloco }} {{ item.professional.name }}
                                  {{ setup == 'CL' ? item.professional.lastName : item.professional.secondLastName }}
                                </p>

                                <!--
                                <div class="btn btn-primary btn-sm rounded-pill float-left">
                                  <ng-container *ngIf="item.isActive; else inactivo">
                                    Activo
                                  </ng-container>
                                  <ng-template #inactivo>Inactivo</ng-template>
                                </div>-->
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-2 p-0">
                        <svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <circle cx="7.5" cy="7.5" r="7.5" fill="#3BC4CA" />
                        </svg>
                      </div>
                      <!--
                        <div class="col-5 text-left p-0">
                          <h3>24</h3>
                          12:45 Hrs.
                        </div>-->
                    </div>
                  </div>
                </ng-container>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!--/tab-->


  </div>
</div>

<modal-create-appointment #modalAppointment></modal-create-appointment>